{% extends "base.html" %}

{% load wagtailcore_tags wagtailimages_tags i18n %}

{% block content %}
    <article class="mx-4">
        <header class="my-6 md:my-12 lg:my-24 container mx-auto">
            {% include "components/navigation/breadcrumbs.html" with page=page %}
            <h1 class="text-3xl sm:text-4xl lg:text-6xl mb-4 font-extrabold">
                {{ page.title }}
            </h1>
            <p>
                {{ page.page_introduction }}
            </p>
        </header>
        <main class="container mx-auto">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-4">
                <h2 class="text-2xl sm:text-3xl lg:text-4xl font-bold">
                    {% trans "Latest Publications" %}
                </h2>
                <form class="flex gap-2">
                    <label class="input">
                        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g
                                stroke-linejoin="round"
                                stroke-linecap="round"
                                stroke-width="2.5"
                                fill="none"
                                stroke="currentColor"
                            >
                                <circle cx="11" cy="11" r="8" />
                                <path d="m21 21-4.3-4.3" />
                            </g>
                        </svg>
                        <input
                            type="search"
                            name="search"
                            placeholder="{% trans 'Search...' %}"
                            value="{{ request.GET.search|default:"" }}"
                        >
                    </label>
                </form>
            </div>

            <!-- Type filter -->
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <a href="{{ page.url }}"
                       class="btn btn-sm {% if selected_type == 'all' %}btn-primary{% else %}btn-outline{% endif %}">
                        {% trans "All" %}
                    </a>
                    <a href="?type=projects"
                       class="btn btn-sm {% if selected_type == 'projects' %}btn-primary{% else %}btn-outline{% endif %}">
                        {% trans "Projects" %}
                    </a>
                    <a href="?type=events"
                       class="btn btn-sm {% if selected_type == 'events' %}btn-primary{% else %}btn-outline{% endif %}">
                        {% trans "Events" %}
                    </a>
                </div>
            </div>

            <!-- Category filter (only for projects) -->
            {% if selected_type == 'projects' %}
            <div class="mb-6">
                <div class="flex flex-wrap gap-2">
                    <a href="?type=projects"
                       class="btn btn-sm btn-xs {% if not selected_category %}btn-secondary{% else %}btn-ghost{% endif %}">
                        {% trans "All categories" %}
                    </a>
                    {% for category_value, category_label in categories %}
                    <a href="?type=projects&category={{ category_value }}"
                       class="btn btn-sm btn-xs {% if selected_category == category_value %}btn-secondary{% else %}btn-ghost{% endif %}">
                        {{ category_label }}
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for publication in publications %}
                    <a
                        href="{{ publication.url }}"
                        class="card bg-base-100 w-full shadow-sm hover:shadow-md transition-shadow duration-100"
                    >
                        <figure>
                            {% if publication.hero_image %}
                                {% image publication.hero_image fill-400x250 alt=publication.title class="w-full h-48 object-cover" %}
                            {% else %}
                                <div class="w-full h-48 bg-base-200 flex items-center justify-center">
                                    {% if publication.get_verbose_name == "Événement" %}
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-base-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                    {% else %}
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-base-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                    </svg>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </figure>
                        <div class="card-body">
                            <h3 class="card-title">
                                {{ publication.title }}
                            </h3>
                            <div class="flex gap-2">
                                {% if publication.get_verbose_name == "Événement" %}
                                    <span class="badge badge-secondary">{% trans "Event" %}</span>
                                    {% if publication.is_upcoming %}
                                        <span class="badge badge-success">{% trans "Upcoming" %}</span>
                                    {% endif %}
                                {% else %}
                                    <span class="badge badge-primary">{% trans "Project" %}</span>
                                    {% if publication.category %}
                                        <span class="badge badge-outline">{{ publication.get_category_display }}</span>
                                    {% endif %}
                                {% endif %}
                            </div>
                            <p class="text-sm text-base-content/70">
                                {{ publication.description|truncatewords:20 }}
                            </p>
                            <div class="flex items-center justify-between mt-2 text-sm text-base-content/60">
                                {% if publication.get_verbose_name == "Événement" %}
                                    <span>{{ publication.event_date|date:"d/m/Y H:i" }}</span>
                                {% else %}
                                    <span>{{ publication.vote_count }} {% trans "votes" %}</span>
                                {% endif %}
                                <span>{{ publication.first_published_at|date:"d/m/Y" }}</span>
                            </div>
                            <div class="card-actions justify-end mt-4">
                                <button class="btn btn-primary">
                                    {% trans "View" %}
                                </button>
                            </div>
                        </div>
                    </a>
                {% empty %}
                    <div class="min-h-64 flex items-center justify-center col-span-1 md:col-span-2 lg:col-span-3">
                        <p>
                            {% trans "No publications found" %}
                        </p>
                    </div>
                {% endfor %}
            </div>
            {% include "components/navigation/pagination.html" with page_data=publications %}
            {% if page.body %}
                <article class="mt-8">{{ page.body|richtext }}</article>
            {% endif %}
        </main>
    </article>
{% endblock content %}
