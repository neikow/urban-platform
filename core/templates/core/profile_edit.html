{% extends "base.html" %}

{% block title %}Modifier mon profil{% endblock %}

{% block content %}
    <div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
            {% if messages %}
                <div class="mb-4 space-y-2">
                    {% for message in messages %}
                        <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% elif message.tags == 'warning' %}alert-warning{% else %}alert-info{% endif %}">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="stroke-current shrink-0 h-6 w-6"
                                fill="none"
                                viewBox="0 0 24 24"
                            >
                                {% if message.tags == 'success' %}
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                                    />
                                {% elif message.tags == 'error' %}
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                                    />
                                {% else %}
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                    />
                                {% endif %}
                            </svg>
                            <span>{{ message }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <div class="flex items-center justify-between mb-6">
                        <h1 class="card-title text-3xl font-bold">
                            Modifier mon profil
                        </h1>
                        <a href="{% url 'me' %}" class="btn btn-ghost btn-sm">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <path d="m12 19-7-7 7-7" />
                                <path d="M19 12H5" />
                            </svg>
                            Retour
                        </a>
                    </div>

                    <div class="space-y-6">
                        <div class="border-b border-base-300 pb-6">
                            <h2 class="text-xl font-semibold mb-4 text-primary">
                                Informations personnelles
                            </h2>

                            {% if form.non_field_errors %}
                                <div class="alert alert-error mb-4">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="stroke-current shrink-0 h-6 w-6"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                                        />
                                    </svg>
                                    <div>
                                        {{ form.non_field_errors }}
                                    </div>
                                </div>
                            {% endif %}

                            <form method="post" action="{% url 'profile_edit' %}" class="space-y-4">
                                {% csrf_token %}

                                {% include "components/forms/form_field.html" with field=form.email %}

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {% include "components/forms/form_field.html" with field=form.first_name %}
                                    {% include "components/forms/form_field.html" with field=form.last_name %}
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {% include "components/forms/form_field.html" with field=form.postal_code %}
                                    {% include "components/forms/form_field.html" with field=form.phone_number %}
                                </div>

                                <div class="form-control">
                                    <label class="label cursor-pointer justify-start gap-3">
                                        <input
                                            type="checkbox"
                                            name="{{ form.newsletter_subscription.html_name }}"
                                            id="{{ form.newsletter_subscription.id_for_label }}"
                                            class="checkbox checkbox-primary"
                                            {% if form.newsletter_subscription.value %}
                                                checked
                                            {% endif %}
                                        >
                                        <span class="label-text">{{ form.newsletter_subscription.label }}</span>
                                    </label>
                                </div>

                                <div class="flex justify-end pt-4">
                                    <button type="submit" class="btn btn-primary">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="16"
                                            height="16"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                            <polyline points="17 21 17 13 7 13 7 21" />
                                            <polyline points="7 3 7 8 15 8" />
                                        </svg>
                                        Enregistrer les modifications
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div>
                            <h2 class="text-xl font-semibold mb-4 text-primary">
                                Changer le mot de passe
                            </h2>

                            {% if password_form.non_field_errors %}
                                <div class="alert alert-error mb-4">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="stroke-current shrink-0 h-6 w-6"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                                        />
                                    </svg>
                                    <div>
                                        {{ password_form.non_field_errors }}
                                    </div>
                                </div>
                            {% endif %}

                            <form method="post" action="{% url 'password_change' %}" class="space-y-4">
                                {% csrf_token %}

                                {% include "components/forms/form_field.html" with field=password_form.current_password %}

                                {% include "components/forms/form_field.html" with field=password_form.new_password %}

                                {% include "components/forms/form_field.html" with field=password_form.confirm_password %}

                                <div class="flex justify-end pt-4">
                                    <button type="submit" class="btn btn-secondary">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="16"
                                            height="16"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                                        </svg>
                                        Changer le mot de passe
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
